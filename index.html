<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>拖曳與縮放範例</title>
  <style>
    #box {
      width: 150px;
      height: 150px;
      background: lightblue;
      position: absolute;
      top: 100px;
      left: 100px;
      touch-action: none; /* 禁止瀏覽器預設手勢 */
    }
  </style>
</head>
<body>
  <div id="box"></div>

  <script>
    const box = document.getElementById("box");
    let pos = { x: 0, y: 0 };
    let scale = 1;

    // 滑鼠拖曳
    box.addEventListener("mousedown", e => {
      pos.x = e.clientX - box.offsetLeft;
      pos.y = e.clientY - box.offsetTop;

      function mouseMove(ev) {
        box.style.left = ev.clientX - pos.x + "px";
        box.style.top = ev.clientY - pos.y + "px";
      }

      function mouseUp() {
        document.removeEventListener("mousemove", mouseMove);
        document.removeEventListener("mouseup", mouseUp);
      }

      document.addEventListener("mousemove", mouseMove);
      document.addEventListener("mouseup", mouseUp);
    });

    // 觸控拖曳 + 縮放
    box.addEventListener("touchstart", e => {
      if (e.touches.length === 1) {
        pos.x = e.touches[0].clientX - box.offsetLeft;
        pos.y = e.touches[0].clientY - box.offsetTop;
      }
    });

    box.addEventListener("touchmove", e => {
      e.preventDefault();
      if (e.touches.length === 1) {
        // 單指拖曳
        box.style.left = e.touches[0].clientX - pos.x + "px";
        box.style.top = e.touches[0].clientY - pos.y + "px";
      } else if (e.touches.length === 2) {
        // 雙指縮放
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (!box.startDistance) {
          box.startDistance = distance;
        } else {
          const newScale = (distance / box.startDistance) * scale;
          box.style.transform = `scale(${newScale})`;
        }
      }
    });

    box.addEventListener("touchend", e => {
      if (e.touches.length < 2) {
        scale = parseFloat(box.style.transform.replace(/scale\((.*)\)/, "$1")) || scale;
        box.startDistance = null;
      }
    });
  </script>
</body>
</html>
